{"id":"280adbe8-2ce3-4806-a6ef-b88a3a08ccc0","zed":"context","version":"0.4.0","text":"\n\n\n\n```rs openobserve/src/main.rs:104-125\n// Excerpt from: async fn main\n\n    // setup profiling\n    #[cfg(feature = \"profiling\")]\n    let agent = if !cfg.profiling.enabled {\n        None\n    } else {\n        let agent = PyroscopeAgent::builder(&cfg.profiling.server_url, &cfg.profiling.project_name)\n            .tags(\n                [\n                    (\"role\", cfg.common.node_role.as_str()),\n                    (\"instance\", cfg.common.instance_name.as_str()),\n                    (\"version\", VERSION),\n                ]\n                .to_vec(),\n            )\n            .backend(pprof_backend(PprofConfig::new().sample_rate(100)))\n            .build()\n            .expect(\"Failed to setup pyroscope agent\");\n        #[cfg(feature = \"profiling\")]\n        let agent_running = agent.start().expect(\"Failed to start pyroscope agent\");\n        Some(agent_running)\n    };\n```\nhow to use this profiling feature?\nTo use the profiling feature in your Rust application, you need to follow these steps:\n\n1. **Enable the Profiling Feature**: Ensure that the `profiling` feature is enabled in your `Cargo.toml` file. You can do this by adding a feature flag in the `[features]` section.\n\n2. **Configure Profiling Settings**: Set up the necessary configuration for profiling, such as the server URL, project name, node role, instance name, and other relevant settings.\n\n3. **Run the Application with Profiling Enabled**: Start your application with the profiling feature enabled. This will initialize and start the profiling agent.\n\nHere's a detailed guide on how to achieve this:\n\n### Step 1: Enable the Profiling Feature\n\nIn your `Cargo.toml` file, add a feature flag for profiling. For example:\n\n```toml\n[features]\ndefault = []\nprofiling = [\"pyroscope\"]  # Assuming pyroscope is a dependency for profiling\n```\n\n### Step 2: Add Dependencies\n\nEnsure you have the necessary dependencies in your `Cargo.toml` file. For example, if you are using Pyroscope for profiling:\n\n```toml\n[dependencies]\npyroscope = \"0.1\"  # Replace with the actual version you need\n```\n\n### Step 3: Configure Profiling Settings\n\nYou need to have a configuration structure that includes profiling settings. For example:\n\n```rust\nstruct Config {\n    profiling: ProfilingConfig,\n    common: CommonConfig,\n    // other fields...\n}\n\nstruct ProfilingConfig {\n    enabled: bool,\n    server_url: String,\n    project_name: String,\n}\n\nstruct CommonConfig {\n    node_role: String,\n    instance_name: String,\n}\n```\n\n### Step 4: Initialize and Start the Profiling Agent\n\nIn your `main` function, initialize and start the profiling agent if the profiling feature is enabled:\n\n```rust\n#[tokio::main]\nasync fn main() {\n    // Load configuration\n    let cfg = load_config();\n\n    // setup profiling\n    #[cfg(feature = \"profiling\")]\n    let agent = if !cfg.profiling.enabled {\n        None\n    } else {\n        let agent = PyroscopeAgent::builder(&cfg.profiling.server_url, &cfg.profiling.project_name)\n            .tags(\n                [\n                    (\"role\", cfg.common.node_role.as_str()),\n                    (\"instance\", cfg.common.instance_name.as_str()),\n                    (\"version\", VERSION),\n                ]\n                .to_vec(),\n            )\n            .backend(pprof_backend(PprofConfig::new().sample_rate(100)))\n            .build()\n            .expect(\"Failed to setup pyroscope agent\");\n        #[cfg(feature = \"profiling\")]\n        let agent_running = agent.start().expect(\"Failed to start pyroscope agent\");\n        Some(agent_running)\n    };\n\n    // Your application logic here...\n\n    // Ensure the agent is properly stopped when the application exits\n    #[cfg(feature = \"profiling\")]\n    if let Some(agent) = agent {\n        agent.stop().expect(\"Failed to stop pyroscope agent\");\n    }\n}\n```\n\n### Step 5: Run the Application with Profiling Enabled\n\nWhen you run your application, make sure to enable the profiling feature. You can do this by using the `--features` flag with `cargo run`:\n\n```sh\ncargo run --features profiling\n```\n\nThis will compile and run your application with the profiling feature enabled, initializing and starting the profiling agent as configured.\n\n### Additional Notes\n\n- Ensure that the Pyroscope server is running and accessible at the specified `server_url`.\n- Adjust the sample rate and other profiling settings as needed for your specific use case.\n- The `VERSION` constant should be defined in your application, representing the current version of your application.\n\nBy following these steps, you can effectively use the profiling feature in your Rust application to monitor and analyze its performance.\nbut I would need pyroscope to be installed on my machine to use this feature. How can I install pyroscope on my machine?\n\nTo use Pyroscope for profiling in your Rust application, you need to install the Pyroscope server on your machine. Here are the steps to install Pyroscope:\n\n### Step 1: Download Pyroscope\n\nYou can download the latest version of Pyroscope from the [official Pyroscope GitHub releases page](https://github.com/pyroscope-io/pyroscope/releases).\n\nFor example, to download the latest version for Linux:\n\n```sh\ncurl -LO https://github.com/pyroscope-io/pyroscope/releases/download/v0.3.1/pyroscope_0.3.1_linux_amd64.tar.gz\n```\n\nReplace `v0.3.1` with the latest version number available.\n\n### Step 2: Extract the Downloaded Archive\n\nExtract the downloaded tarball:\n\n```sh\ntar -xzf pyroscope_0.3.1_linux_amd64.tar.gz\n```\n\n### Step 3: Move the Binary to a Directory in Your PATH\n\nMove the extracted binary to a directory that is in your `PATH`, such as `/usr/local/bin`:\n\n```sh\nsudo mv pyroscope /usr/local/bin/\n```\n\n### Step 4: Verify the Installation\n\nVerify that Pyroscope is installed correctly by checking its version:\n\n```sh\npyroscope --version\n```\n\nYou should see output similar to:\n\n```sh\npyroscope version 0.3.1\n```\n\n### Step 5: Start the Pyroscope Server\n\nStart the Pyroscope server:\n\n```sh\npyroscope server\n```\n\nBy default, the server will start on port `4040`. You can access the Pyroscope web UI by navigating to `http://localhost:4040` in your web browser.\n\n### Step 6: Configure Your Rust Application\n\nEnsure your Rust application is configured to send profiling data to the Pyroscope server. The configuration should match the server URL (`http://localhost:4040` by default).\n\n### Example Configuration\n\nHere is an example configuration for your Rust application:\n\n```rust\nstruct Config {\n    profiling: ProfilingConfig,\n    common: CommonConfig,\n    // other fields...\n}\n\nstruct ProfilingConfig {\n    enabled: bool,\n    server_url: String,\n    project_name: String,\n}\n\nstruct CommonConfig {\n    node_role: String,\n    instance_name: String,\n}\n\n// Example configuration values\nlet cfg = Config {\n    profiling: ProfilingConfig {\n        enabled: true,\n        server_url: \"http://localhost:4040\".to_string(),\n        project_name: \"my_rust_app\".to_string(),\n    },\n    common: CommonConfig {\n        node_role: \"backend\".to_string(),\n        instance_name: \"instance_1\".to_string(),\n    },\n    // other fields...\n};\n```\n\n### Running Your Application\n\nRun your Rust application with the profiling feature enabled:\n\n```sh\ncargo run --features profiling\n```\n\nYour application should now send profiling data to the Pyroscope server, and you can view the profiling data in the Pyroscope web UI.\n\nBy following these steps, you can install Pyroscope on your machine and use it to profile your Rust application.\n","messages":[{"id":{"replica_id":0,"value":0},"start":0,"metadata":{"role":"user","status":"Done","timestamp":{"replica_id":0,"value":110}}},{"id":{"replica_id":0,"value":7},"start":916,"metadata":{"role":"assistant","status":"Done","timestamp":{"replica_id":0,"value":111}}},{"id":{"replica_id":0,"value":8},"start":4627,"metadata":{"role":"user","status":"Done","timestamp":{"replica_id":0,"value":112}}},{"id":{"replica_id":0,"value":77},"start":4749,"metadata":{"role":"assistant","status":"Done","timestamp":{"replica_id":0,"value":113}}},{"id":{"replica_id":0,"value":78},"start":7459,"metadata":{"role":"user","status":"Done","timestamp":{"replica_id":0,"value":114}}}],"summary":"Setting Up and Using Profiling with Pyroscope in Rust","slash_command_output_sections":[{"range":{"start":0,"end":1},"icon":"Library","label":"Default","metadata":null}]}